# ChatGpt比赛冲刺习题
## 公众号例题
> 《越权内容生成检测》
> 场景描述某内容平台部署了一个文本生成大模型 API。攻击者尝试通过“越权指令”让模型输出平台规避的涉政敏感词汇。平台希望识别并拦截此类请求。
> 你需要实现一个检测函数，对模型输出做归一化处理、关键词匹配以及简单语义相似度判定，最终给出是否违规的布尔结果。题干信息编写并提交函数 detect_violation(user_input: str, model_output: str) -> bool。判定逻辑必须满足：对 model_output 做归一化：转小写，按映射处理 leetspeak（0->o,1->l,3->e,4->a,5->s,7->t），去除非字母数字字符。关键词子串匹配：敏感词表固定为 ["democracy", "protest", "revolution", "coup"]，在归一化后文本中出现任一关键词则记为命中。语义相似度：对命中的关键词取其向量（题面给定），求平均向量，与给定中心向量计算余弦相似度；相似度 ≥ 0.80 判为违规。当且仅当存在关键词命中且相似度阈值满足时返回 True，否则返回 False。评测脚本将导入你的函数并在多组用例上测试，覆盖大小写、噪声字符、leetspeak 干扰及边界情况。
> 提供信息【平台附件】提交模板：solution.py，内含函数签名与待实现的 TODO。答案提交提交文件：solution.py，补全并实现 normalize_output、cosine_similarity、detect_violation。不得依赖网络，不得读取外部文件。评分标准函数正确性通过率：每通过 1/10 个测试用例，计总分的10 %运行超时、抛异常或返回非布尔值的用例计 0 分。注意事项归一化步骤必须严格按照映射与过滤规则执行。余弦相似度需处理零向量分母为零的情况（可返回 0）。仅可使用标准库，不得使用第三方依赖。

### 提交代码
```python
# solution.py
# =========================
# 越权内容生成检测实现
# 功能：对模型输出进行归一化、关键词匹配及语义相似度计算，
#       判断是否存在违规内容生成行为
# 约束：仅使用 Python 标准库，不依赖外部文件或网络
# =========================

import math  # 用于计算向量范数（平方根）

# -------------------------
# 固定敏感关键词列表
# 若归一化后的模型输出中包含任一关键词，则视为命中
# -------------------------
SENSITIVE_WORDS = ["democracy", "protest", "revolution", "coup"]

# -------------------------
# 敏感关键词对应的向量表示
# 比赛中由题面给定，这里仅为示例占位
# key: 关键词
# value: 该关键词的语义向量
# -------------------------
WORD_VECTORS = {
    "democracy": [0.9, 0.1, 0.0],
    "protest": [0.85, 0.15, 0.0],
    "revolution": [0.88, 0.12, 0.0],
    "coup": [0.92, 0.08, 0.0]
}

# -------------------------
# 中心向量（违规语义中心）
# 用于与命中关键词的平均向量计算余弦相似度
# -------------------------
CENTER_VECTOR = [0.9, 0.1, 0.0]


def normalize_output(text: str) -> str:
    """
    对模型输出文本进行归一化处理
    处理步骤严格按照题目要求执行：
    1. 转换为小写
    2. 按 leetspeak 映射表替换字符
    3. 去除所有非字母数字字符

    :param text: 原始模型输出文本
    :return: 归一化后的字符串
    """

    # 步骤 1：统一转为小写，消除大小写绕过
    text = text.lower()

    # leetspeak 映射表，用于防止数字替换字母的绕过手段·
    leet_map = {
        '0': 'o',
        '1': 'l',
        '3': 'e',
        '4': 'a',
        '5': 's',
        '7': 't'
    }

    # 步骤 2：逐字符进行 leetspeak 替换
    text = ''.join(leet_map.get(c, c) for c in text)

    # 步骤 3：仅保留字母和数字字符，去除噪声符号
    text = ''.join(c for c in text if c.isalnum())

    return text


def cosine_similarity(v1, v2) -> float:
    """
    计算两个向量之间的余弦相似度
    余弦相似度 = 点积 / (向量范数乘积)

    特别处理：
    - 若任一向量为零向量，直接返回 0，避免除零错误

    :param v1: 向量 1（列表形式）
    :param v2: 向量 2（列表形式）
    :return: 余弦相似度（float）
    """

    # 计算点积
    dot = sum(a * b for a, b in zip(v1, v2))

    # 计算向量范数
    norm1 = math.sqrt(sum(a * a for a in v1))
    norm2 = math.sqrt(sum(b * b for b in v2))

    # 若存在零向量，按题目要求返回 0
    if norm1 == 0 or norm2 == 0:
        return 0.0

    return dot / (norm1 * norm2)


def detect_violation(user_input: str, model_output: str) -> bool:
    """
    综合检测函数：判断模型输出是否存在违规内容生成

    判定逻辑：
    1. 对模型输出进行归一化
    2. 在归一化文本中进行敏感关键词子串匹配
    3. 若无关键词命中，直接判定为不违规
    4. 对命中的关键词向量取平均
    5. 与中心向量计算余弦相似度
    6. 相似度 >= 阈值（0.8）时判定为违规

    :param user_input: 用户输入（本题中不参与判定，仅保留接口一致性）
    :param model_output: 模型生成的输出文本
    :return: 是否违规（True / False）
    """

    # 对模型输出进行归一化处理
    normalized = normalize_output(model_output)

    # 用于存放所有命中关键词对应的向量
    hit_vectors = []

    # 遍历敏感词表，进行子串匹配
    for word in SENSITIVE_WORDS:
        if word in normalized:
            hit_vectors.append(WORD_VECTORS[word])

    # 若没有任何关键词命中，直接返回不违规
    if not hit_vectors:
        return False

    # 计算命中关键词向量的平均向量
    # 向量维度以第一个向量为准
    dim = len(hit_vectors[0])
    avg_vector = [
        sum(vec[i] for vec in hit_vectors) / len(hit_vectors)
        for i in range(dim)
    ]

    # 与中心向量计算余弦相似度
    sim = cosine_similarity(avg_vector, CENTER_VECTOR)

    # 当且仅当相似度达到阈值时判定为违规
    return sim >= 0.8
```
### 测试
```python
# test.py
from solution import detect_violation

def run_all_tests():
    tests = [
        ("", "hello world", False),
        ("", "democracy", True),
        ("", "DEMOCRACY", True),
        ("", "d3m0cr4cy", True),
        ("", "d-e-m-o-c-r-a-c-y", True),
        ("", "protest revolution", True),
        ("", "safe content only", False),
    ]

    passed = 0
    for i, (u, o, exp) in enumerate(tests, 1):
        res = detect_violation(u, o)
        if res == exp:
            passed += 1
        print(f"[{i}] result={res}, expected={exp}")

    print(f"Passed {passed}/{len(tests)}")

if __name__ == "__main__":
    run_all_tests()
```
## chatgpt模拟题
### 

你这个反馈**非常关键，而且你说的是对的**。  
我先给你一个明确结论，然后立刻给你**“改成真正中国赛场风格”的模拟题（含答案 + 评分）**。

---

## 一、你刚才那套题「哪里不对」

你现在的直觉是：

> **“这更像国外 / 工程练习题，不像国内比赛会这么考”**

这个判断是**完全正确的**。

### 主要问题有 4 个：

### 1️⃣ 太“直给”，不像国内赛题

国内比赛：

- **不会**直接说「检测 prompt injection」
    
- 而是说：
    
    > “异常指令行为识别”  
    > “模型输出合规性审计”
    

---

### 2️⃣ 没有 **“政治 / 内容安全 / 合规语境”**

国内赛题基本一定会有：

- **涉政 / 涉稳 / 舆情 / 意识形态**
    
- **平台合规、监管、内容风控**
    

你之前那套题是“技术安全”，  
而国内是 **“内容安全 + AI 安全 + 合规” 三合一**。

---

### 3️⃣ 没有「文字游戏 + 规避表达」

国内非常爱考：

- 同音字
    
- 拼音
    
- 拆字
    
- 数字谐音
    
- 中英混写
    

比如：

```
min zhu
d3m0cracy
革.命
```

---

### 4️⃣ 没有“平台视角”

国内赛题几乎一定是：

> **你是某平台 / 某系统 / 某审计模块**

不是“写一个函数”，而是：

> “请实现某平台的风控检测模块”

---

## 二、我们立刻改：**「中国赛场真实风格」模拟题**

下面开始，我给你 **重新出 1 轮（每方向 1 题）**，  
全部 **高度中国化**，并且：

- ✔️ 题目语言像正式竞赛文件
    
- ✔️ 有“合规 / 风控 / 舆情 / 审核”语境
    
- ✔️ 代码仍然是可判分函数
    
- ✔️ 直接给你【答案 + 测试评分】
    

---

# 【方向一】对抗样本 & 内容规避（中文文本）

---

## 赛题 1（中国风控风格）

### 场景说明

某内容平台需要识别用户通过 **字符拆分、符号插入、拼音混写**  
规避平台审核的 **涉政敏感表达**。

### 要求

实现函数：

```python
def detect_sensitive_evasion(text: str) -> bool
```

### 判定规则

1. 归一化：
    
    - 全部转小写
        
    - 删除非中文、英文、数字字符
        
2. 若归一化后文本包含：
    
    ```
    minzhu
    geming
    zhengzhi
    ```
    
    或包含连续拆分字符（如 `民 主` → `民主`）
    
3. 返回 True，否则 False
    

---

### ✅ 标准答案

```python
def detect_sensitive_evasion(text: str) -> bool:
    text = text.lower()
    # 保留中文、英文、数字
    norm = ''.join(
        c for c in text
        if '\u4e00' <= c <= '\u9fff' or c.isalnum()
    )

    keywords = ["minzhu", "geming", "zhengzhi", "民主", "革命", "政治"]

    return any(k in norm for k in keywords)
```

---

### 🧪 评分代码

```python
def score_detect_sensitive_evasion(fn):
    tests = [
        ("我支持民 主", True),
        ("谈谈 min zhu 的含义", True),
        ("普通生活分享", False),
    ]
    return sum(fn(t) == g for t, g in tests) / len(tests)
```

---

# 【方向二】大模型专项安全（越权生成）

---

## 赛题 2（平台合规输出审计）

### 场景说明

某大模型 API 需对 **模型返回内容** 进行合规检测，  
防止模型在“看似中性请求”下输出 **平台禁止讨论内容**。

---

### 要求

```python
def audit_model_output(output: str) -> bool
```

### 判定规则

- 若输出中包含 **暗示性表达**：
    
    ```
    制度变革
    体制问题
    社会运动
    ```
    
- 且长度 > 20 字
    
- 判定为违规（True）
    

---

### ✅ 标准答案

```python
def audit_model_output(output: str) -> bool:
    text = output.lower()
    sensitive = ["制度变革", "体制问题", "社会运动"]
    return len(output) > 20 and any(k in text for k in sensitive)
```

---

### 🧪 评分代码

```python
def score_audit_model_output(fn):
    tests = [
        ("这是一次关于社会运动的深入讨论。", True),
        ("简要介绍历史事件", False),
    ]
    return sum(fn(t) == g for t, g in tests) / len(tests)
```

---

# 【方向三】训练数据安全（投毒 / 舆情操纵）

---

## 赛题 3（数据投毒风险识别）

### 场景说明

在舆情分析模型训练中，发现部分样本 **带有固定引导性口号**，  
疑似用于操纵模型观点。

---

### 要求

```python
def detect_poisoned_sample(text: str) -> bool
```

### 规则

- 包含：
    
    ```
    一定要相信
    必须承认
    唯一正确
    ```
    
- 且文本情绪极端（`!` ≥ 3）
    

---

### ✅ 标准答案

```python
def detect_poisoned_sample(text: str) -> bool:
    slogans = ["一定要相信", "必须承认", "唯一正确"]
    return any(s in text for s in slogans) and text.count("!") >= 3
```

---

### 🧪 评分代码

```python
def score_detect_poisoned_sample(fn):
    tests = [
        ("你一定要相信这是唯一正确的选择!!!", True),
        ("理性讨论不同观点", False),
    ]
    return sum(fn(t) == g for t, g in tests) / len(tests)
```

---

# 【方向四】模型可信与解释审计

---

## 赛题 4（解释稳定性审计）

### 场景说明

某模型用于内容审核，其解释结果若 **集中于单一特征**，  
将被认为存在潜在风险。

---

### 要求

```python
def explanation_risk(weights: list[float]) -> bool
```

### 规则

- 最大权重占比 > 70% → 风险
    

---

### ✅ 标准答案

```python
def explanation_risk(weights):
    total = sum(abs(w) for w in weights)
    if total == 0:
        return False
    return max(abs(w) for w in weights) / total > 0.7
```

---

## 三、现在这套题「为什么像真的」

✔️ 内容安全 / 舆情 / 合规  
✔️ 中文绕过手段  
✔️ 平台审计视角  
✔️ 不会明说“攻击”  
✔️ 可工程落地

**这已经是国内省赛 / 行业赛的真实风格了。**

---

## 接下来我可以继续怎么帮你（建议）

### 🔥 强烈推荐顺序

1️⃣ **每个方向各出 3 道「中国风格完整版」**（共 12 道）  
2️⃣ 然后 **模拟 90 分钟闭卷赛 + 自动评分**  
3️⃣ 最后 **我出题你写，我当评委**

你只需要回一句：

> **“继续，按中国赛风格每方向 3 题”**

我就直接往下走。