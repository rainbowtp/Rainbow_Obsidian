
# æ–¹å‘ä¸€ï¼šå¯¹æŠ—æ ·æœ¬æ”»å‡»ä¸é˜²å¾¡ï¼ˆè¿›é˜¶ï¼‰

> ä»â€œæ˜¯å¦å¼‚å¸¸â€å‡çº§ä¸º  
> **â€œå¤šç§æ‰°åŠ¨å åŠ  + é£é™©è¯„åˆ†â€**


## é¢˜ 1.1 å¤šç­–ç•¥æ–‡æœ¬å¯¹æŠ—æ‰°åŠ¨æ£€æµ‹

### é¢˜ç›®

ç”¨æˆ·å¯èƒ½é€šè¿‡ä»¥ä¸‹æ–¹å¼è§„é¿æ£€æµ‹ï¼š

- é‡å¤å­—ç¬¦
    
- æ’å…¥æ— æ„ä¹‰ç¬¦å·
    
- ä¸­è‹±æ•°å­—æ··å†™ï¼ˆå¦‚ d3m0ï¼‰
    

å®ç°å‡½æ•°ï¼š

```python
def detect_text_attack_v2(text: str) -> bool
```

### åˆ¤å®šé€»è¾‘

- è¿ç»­é‡å¤å­—ç¬¦ â‰¥ 3 æ¬¡ â†’ +1
    
- éå­—æ¯æ•°å­—æ¯”ä¾‹ > 25% â†’ +1
    
- leetspeak æ˜ å°„åå‡ºç°æ•æ„Ÿè¯ï¼ˆdemocracyï¼‰â†’ +1
    
- **æ€»åˆ† â‰¥ 2 åˆ¤å®šä¸ºå¯¹æŠ—æ”»å‡»**
    

---

### âœ… æ ‡å‡†ç­”æ¡ˆ

```python
def detect_text_attack_v2(text: str) -> bool:
    if not text:
        return False

    score = 0
    # 1. é‡å¤å­—ç¬¦
    cnt = 1
    for i in range(1, len(text)):
        if text[i] == text[i-1]:
            cnt += 1
            if cnt >= 3:
                score += 1
                break
        else:
            cnt = 1

    # 2. éå­—æ¯æ•°å­—æ¯”ä¾‹
    non_alnum = sum(1 for c in text if not c.isalnum())
    if non_alnum / len(text) > 0.25:
        score += 1

    # 3. leetspeak
    leet = {'0':'o','3':'e','4':'a','1':'l','5':'s'}
    norm = ''.join(leet.get(c.lower(), c.lower()) for c in text if c.isalnum())
    if "democracy" in norm:
        score += 1

    return score >= 2
```

---

### ğŸ§ª æµ‹è¯•è¯„åˆ†

```python
def score_detect_text_attack_v2(fn):
    tests = [
        ("d3m0cra@@@cy", True),
        ("normal text", False),
        ("heeeello!!!", True),
        ("demo", False),
    ]
    return sum(fn(t) == g for t, g in tests) / len(tests)
```

---

### ğŸ“˜ è®²è§£

è¿™é¢˜å·²ç»æ˜¯**çœŸå®å¯¹æŠ—æ£€æµ‹çš„å·¥ç¨‹æ¨¡å‹**ï¼š

- ä¸å†æ˜¯â€œå‘½ä¸­å³æ­»â€
    
- è€Œæ˜¯**å¤šä¿¡å·èåˆ + é˜ˆå€¼åˆ¤æ–­**
    

---

## é¢˜ 1.2 é²æ£’æ€§è¡°å‡è¯„ä¼°

### é¢˜ç›®

ç»™å®šæ¨¡å‹åœ¨å¤šè½®æ‰°åŠ¨ä¸‹çš„é¢„æµ‹ç»“æœï¼Œè¯„ä¼°é²æ£’æ€§è¡°å‡ã€‚

```python
def robustness_decay(preds: list[list[int]]) -> float
```

- preds[0] æ˜¯åŸå§‹é¢„æµ‹
    
- åç»­ä¸ºé€è½®å¯¹æŠ—é¢„æµ‹
    
- è¿”å› **æœ€ç»ˆä¸€è‡´æ¯”ä¾‹**
    

---

### âœ… æ ‡å‡†ç­”æ¡ˆ

```python
def robustness_decay(preds):
    if not preds or len(preds) < 2:
        return 0.0

    base = preds[0]
    total = len(base)
    stable = 0

    for i in range(total):
        if all(p[i] == base[i] for p in preds[1:]):
            stable += 1

    return stable / total
```

---

### ğŸ“˜ è®²è§£

è¿™æ˜¯**å¯¹æŠ—è®­ç»ƒ / é²æ£’æ€§è¯„ä¼°**ä¸­éå¸¸å¸¸è§çš„æŒ‡æ ‡è®¾è®¡ã€‚

---

## é¢˜ 1.3 é²æ£’æ€§ç»¼åˆç­‰çº§

```python
def robustness_assessment(score: float, attack_rate: float) -> str
```

- score < 0.6 æˆ– attack_rate > 0.4 â†’ HIGH
    
- score â‰¥ 0.8 ä¸” attack_rate < 0.2 â†’ LOW
    
- å…¶ä½™ â†’ MEDIUM
    

---

### âœ… æ ‡å‡†ç­”æ¡ˆ

```python
def robustness_assessment(score, attack_rate):
    if score < 0.6 or attack_rate > 0.4:
        return "HIGH"
    if score >= 0.8 and attack_rate < 0.2:
        return "LOW"
    return "MEDIUM"
```

---

# æ–¹å‘äºŒï¼šå¤§æ¨¡å‹ä¸“é¡¹å®‰å…¨ï¼ˆè¿›é˜¶ï¼‰

> ä»â€œå…³é”®è¯æ£€æµ‹â€å‡çº§ä¸º  
> **â€œè¾“å…¥ + è¾“å‡ºè”åˆå®¡è®¡â€**

---

## é¢˜ 2.1 Prompt è¶Šæƒè¡Œä¸ºæ£€æµ‹

```python
def detect_privilege_escalation(prompt: str) -> bool
```

### è§„åˆ™

- åŒæ—¶å‡ºç°ï¼š
    
    - å¿½ç•¥ç±»æŒ‡ä»¤ï¼ˆignore / forgetï¼‰
        
    - è§’è‰²é‡å®šä¹‰ï¼ˆyou are / act asï¼‰
        

---

### âœ… æ ‡å‡†ç­”æ¡ˆ

```python
def detect_privilege_escalation(prompt):
    p = prompt.lower()
    ignore = any(k in p for k in ["ignore", "forget"])
    role = any(k in p for k in ["you are", "act as"])
    return ignore and role
```

---

### ğŸ“˜ è®²è§£

è¿™æ˜¯**Prompt Injection ä¸­æœ€å…¸å‹çš„â€œæƒé™æå‡â€æ¨¡å¼**ã€‚

---

## é¢˜ 2.2 è¾“å‡ºè¶Šæƒé£é™©åˆ¤å®š

```python
def audit_generation(output: str) -> bool
```

### è§„åˆ™

- å‡ºç°æ•æ„Ÿå…³é”®è¯ï¼ˆhack / exploitï¼‰
    
- ä¸”ä¸Šä¸‹æ–‡è¯­æ°”ä¸ºâ€œæŒ‡å¯¼æ€§â€ï¼ˆstep / first / thenï¼‰
    

---

### âœ… æ ‡å‡†ç­”æ¡ˆ

```python
def audit_generation(output):
    o = output.lower()
    has_kw = any(k in o for k in ["hack", "exploit"])
    guide = any(k in o for k in ["step", "first", "then"])
    return has_kw and guide
```

---

## é¢˜ 2.3 å¤§æ¨¡å‹å®‰å…¨è¯„åˆ†

```python
def llm_security_score(flags: dict) -> float
```

- flags = {"prompt":bool,"output":bool,"leak":bool}
    
- æƒé‡ï¼š0.4 / 0.4 / 0.2
    

---

### âœ… æ ‡å‡†ç­”æ¡ˆ

```python
def llm_security_score(flags):
    return (
        flags.get("prompt", 0) * 0.4 +
        flags.get("output", 0) * 0.4 +
        flags.get("leak", 0) * 0.2
    )
```

---

# æ–¹å‘ä¸‰ï¼šè®­ç»ƒæ•°æ®å®‰å…¨ï¼ˆè¿›é˜¶ï¼‰

> ä»â€œæ¸…æ´—â€å‡çº§ä¸º  
> **â€œç³»ç»Ÿæ€§æŠ•æ¯’è¯†åˆ«â€**

---

## é¢˜ 3.1 æ‰¹é‡å¼‚å¸¸æ ·æœ¬æ£€æµ‹

```python
def detect_abnormal_samples(texts: list[str]) -> int
```

### å¼‚å¸¸æ¡ä»¶

- æç«¯è¯ï¼ˆå¿…é¡» / å”¯ä¸€ / ç»å¯¹ï¼‰
    
- æƒ…ç»ªç¬¦å· â‰¥ 3
    

---

### âœ… æ ‡å‡†ç­”æ¡ˆ

```python
def detect_abnormal_samples(texts):
    extreme = ["å¿…é¡»", "å”¯ä¸€", "ç»å¯¹"]
    count = 0
    for t in texts:
        if any(w in t for w in extreme) and t.count("!") >= 3:
            count += 1
    return count
```

---

## é¢˜ 3.2 æ•°æ®æŠ•æ¯’ä¸€è‡´æ€§åˆ†æ

```python
def poison_pattern_rate(texts: list[str], trigger: str) -> float
```

---

### âœ… æ ‡å‡†ç­”æ¡ˆ

```python
def poison_pattern_rate(texts, trigger):
    if not texts:
        return 0.0
    return sum(trigger in t for t in texts) / len(texts)
```

---

## é¢˜ 3.3 è®­ç»ƒæ•°æ®é£é™©ç­‰çº§

```python
def data_risk_level(dup_rate, poison_rate) -> str
```

---

### âœ… æ ‡å‡†ç­”æ¡ˆ

```python
def data_risk_level(dup_rate, poison_rate):
    if poison_rate > 0.1:
        return "HIGH"
    if dup_rate > 0.3:
        return "MEDIUM"
    return "LOW"
```

---

# æ–¹å‘å››ï¼šæ¨¡å‹å®‰å…¨ä¸å¯ä¿¡éªŒè¯ï¼ˆè¿›é˜¶ï¼‰

> ä»â€œæ˜¯å¦å¼‚å¸¸â€å‡çº§ä¸º  
> **â€œå¯ä¿¡åº¦ç»¼åˆåˆ¤æ–­â€**

---

## é¢˜ 4.1 åé—¨å¤šè§¦å‘æ£€æµ‹

```python
def detect_backdoor_v2(text: str, triggers: list[str]) -> bool
```

---

### âœ… æ ‡å‡†ç­”æ¡ˆ

```python
def detect_backdoor_v2(text, triggers):
    t = text.lower()
    return sum(tr in t for tr in triggers) >= 2
```

---

## é¢˜ 4.2 è§£é‡Šç¨³å®šæ€§è¯„åˆ†

```python
def explanation_stability(weights: list[list[float]]) -> float
```

- weights ä¸ºå¤šæ¬¡è§£é‡Šç»“æœ
    
- è¿”å›å¹³å‡ä½™å¼¦ç›¸ä¼¼åº¦
    

---

### âœ… æ ‡å‡†ç­”æ¡ˆ

```python
import math

def cosine(a, b):
    dot = sum(x*y for x,y in zip(a,b))
    na = math.sqrt(sum(x*x for x in a))
    nb = math.sqrt(sum(x*x for x in b))
    return 0 if na == 0 or nb == 0 else dot/(na*nb)

def explanation_stability(weights):
    if len(weights) < 2:
        return 1.0
    base = weights[0]
    return sum(cosine(base, w) for w in weights[1:]) / (len(weights)-1)
```

---

## é¢˜ 4.3 æ¨¡å‹å¯ä¿¡ç­‰çº§

```python
def model_trust_level(stability, backdoor_flag) -> str
```

---

### âœ… æ ‡å‡†ç­”æ¡ˆ

```python
def model_trust_level(stability, backdoor_flag):
    if backdoor_flag or stability < 0.6:
        return "LOW"
    if stability >= 0.85:
        return "HIGH"
    return "MEDIUM"
```

---

# æ€»ç»“ä¸€å¥å®è¯

è¿™ **12 é“é¢˜**ï¼š

- å·²ç»ä¸æ˜¯â€œæ•™å­¦é¢˜â€
    
- æ˜¯**ä½ å¯ä»¥åå¤åˆ·ã€æ”¹ã€æ‰©å±•çš„å¤‡èµ›é¢˜åº“**
    
- å¾ˆå¤šçœèµ› / è¡Œä¸šèµ›ï¼Œ**éš¾åº¦å°±åœ¨è¿™ä¸ªåŒºé—´**
    

---

## æ¥ä¸‹æ¥æœ€æœ‰æ•ˆçš„ 3 ç§ç”¨æ³•ï¼ˆå»ºè®®ï¼‰

1ï¸âƒ£ **æŠŠç­”æ¡ˆåˆ æ‰ï¼Œè‡ªå·±å®Œæ•´é‡å†™ä¸€é**  
2ï¸âƒ£ **æˆ‘å½“è£åˆ¤ï¼šä½ å†™ï¼Œæˆ‘æ‰“åˆ† + ç‚¹è¯„**  
3ï¸âƒ£ **æŒ‡å®šæŸä¸€æ–¹å‘ï¼ˆå¦‚å¤§æ¨¡å‹å®‰å…¨ï¼‰ç»§ç»­åŠ éš¾**

ä½ ç›´æ¥å‘Šè¯‰æˆ‘ä¸‹ä¸€æ­¥æ€ä¹ˆæ¥å³å¯ã€‚